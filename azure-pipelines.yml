
pool:
  vmImage: ubuntu-16.04

jobs:

  - deployment: pull_envs
    displayName: Pull all IVRs
    environment: pull
    strategy:
      runOnce:
        deploy:
          steps:
            - checkout: self
              persistCredentials: true
            - bash: |
                ls -lah
                
                echo "building and running sync image..."
                docker build -t ivr-sync .
                docker run --rm --mount type=bind,src=$(pwd)/data,dst=/sync/data ivr-sync ./pull-all.sh

                echo "versioning new IVR states..."
                git config --global user.email "wjconnor123@gmail.com"
                git config --global user.name "William Connor"
                git status
                git add . && git commit -m "added a file [skip ci]"
                git push origin HEAD:master


            # - publish: $(Build.SourcesDirectory)/build
            #   artifact: my_build

  # # download build artifact and put in version control 
  # - job: commit_file
  #   dependsOn: create_file
  #   timeoutInMinutes: 3
  #   steps:
  #     - checkout: self
  #       persistCredentials: true
  #     - task: DownloadPipelineArtifact@2
  #       inputs:
  #         artifact: my_build
  #         path: $(Build.SourcesDirectory)/build
  #     - bash: |
  #         echo "current directory is $(pwd)"
  #         git config --global user.email "wjconnor123@gmail.com"
  #         git config --global user.name "William Connor"
  #         git status
  #         git add . && git commit -m "added a file [skip ci]"
  #         git push origin HEAD:master
